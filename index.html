<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>5K Digital Studio - Download Digital Assets & Courses</title>
    <style>
        /* Base & Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f7f9fc; /* Light, clean background */
            color: #2c3e50; /* Dark blue for primary text */
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: background-color 0.4s ease, color 0.4s ease;
        }

        /* Dark Mode Styles */
        body.dark-mode {
            background-color: #1a202c; /* Dark charcoal */
            color: #e2e8f0; /* Light gray for dark mode text */
        }

        body.dark-mode .asset-card,
        body.dark-mode .page-content,
        body.dark-mode .search-bar,
        body.dark-mode .modal-content {
            background-color: #2d3748; /* Darker charcoal for elements */
            color: #e2e8f0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        }

        body.dark-mode .asset-description,
        body.dark-mode .asset-meta,
        body.dark-mode .page-content p,
        body.dark-mode .faq-answer,
        body.dark-mode .blog-excerpt {
            color: #a0aec0; /* Muted gray for secondary text */
        }

        body.dark-mode .search-bar input {
            background-color: #2d3748;
            color: #e2e8f0;
            border-color: #4a5568;
        }

        body.dark-mode .page-title,
        body.dark-mode .asset-title,
        body.dark-mode .faq-question,
        body.dark-mode .blog-title,
        body.dark-mode .modal-title {
            color: #4CAF50; /* Vibrant green accent for dark mode titles */
        }

        body.dark-mode .mobile-menu-items {
            background-color: #2d3748;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        body.dark-mode .menu-items a {
            color: #e2e8f0;
        }

        body.dark-mode .menu-items a:hover {
            background-color: #4a5568;
        }

        body.dark-mode .modal-header,
        body.dark-mode .modal-footer {
            border-color: #4a5568;
        }
        
        body.dark-mode .modal-close {
            color: #a0aec0;
        }

        body.dark-mode .download-btn,
        body.dark-mode .submit-btn,
        body.dark-mode .search-bar button,
        body.dark-mode .page-btn.active,
        body.dark-mode .page-btn:hover {
            background-color: #4CAF50; /* Green accent */
            border-color: #4CAF50;
        }

        body.dark-mode .download-btn:hover,
        body.dark-mode .submit-btn:hover,
        body.dark-mode .search-bar button:hover {
            background-color: #43A047; /* Darker green */
        }

        body.dark-mode .page-btn {
            background-color: #4a5568;
            border-color: #4a5568;
            color: #e2e8f0;
        }

        body.dark-mode footer {
            background: #2d3748;
            color: #a0aec0;
        }

        body.dark-mode .social-icons a {
            color: #e2e8f0;
        }
        body.dark-mode .social-icons a:hover {
            color: #4CAF50;
        }
        body.dark-mode .copyright {
            color: #6a7688;
        }


        /* Popup Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6); /* Slightly softer overlay */
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease-out;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 650px;
            max-height: 85vh;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
            transform: translateY(30px) scale(0.95);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Springy effect */
            display: flex;
            flex-direction: column;
        }

        .modal-overlay.active .modal-content {
            transform: translateY(0) scale(1);
        }

        .modal-header {
            padding: 1.2rem 1.5rem;
            border-bottom: 1px solid #edf2f7; /* Light border */
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.6rem;
            font-weight: 700;
            color: #2980b9; /* A professional blue */
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: #7f8c8d;
            padding: 5px 10px;
            border-radius: 50%;
            transition: background 0.2s ease, color 0.2s ease;
        }

        .modal-close:hover {
            background: #e0e6eb;
            color: #34495e;
        }

        .modal-body {
            padding: 1.5rem;
            overflow-y: auto;
            flex-grow: 1;
            font-size: 0.95rem;
            line-height: 1.7;
        }

        .modal-image {
            width: 100%;
            height: 250px;
            object-fit: cover;
            margin-bottom: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        }

        .modal-description {
            margin-bottom: 1.5rem;
        }

        .modal-footer {
            padding: 1.2rem 1.5rem;
            border-top: 1px solid #edf2f7;
            display: flex;
            justify-content: flex-end;
        }
        
        /* Header */
        header {
            background: linear-gradient(135deg, #2980b9 0%, #3498db 100%); /* Blue gradient */
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-left {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 0.2rem;
            cursor: pointer;
            letter-spacing: -0.5px;
        }
        
        /* Menu Styles */
        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .dark-mode-toggle, .menu-btn {
            background: rgba(255, 255, 255, 0.25);
            border: none;
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 1.2rem;
            transition: background 0.3s ease, transform 0.2s ease;
        }

        .dark-mode-toggle:hover, .menu-btn:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: translateY(-2px);
        }

        .desktop-menu {
            display: none;
        }

        @media (min-width: 769px) {
            .menu-btn {
                display: none;
            }
            .desktop-menu {
                display: flex;
                gap: 20px;
            }
        }

        .mobile-menu-items {
            display: none;
            position: absolute;
            top: 100%;
            right: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            z-index: 99;
            min-width: 180px;
            transform-origin: top right;
            transform: scale(0.9) translateY(-10px);
            opacity: 0;
            transition: transform 0.2s ease-out, opacity 0.2s ease-out;
        }

        .mobile-menu-items.active {
            display: block;
            transform: scale(1) translateY(0);
            opacity: 1;
        }

        .menu-items a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: #34495e;
            text-decoration: none;
            transition: background 0.2s ease;
            cursor: pointer;
            gap: 10px;
        }

        .menu-items a:hover {
            background: #ecf0f1;
        }

        .desktop-menu a {
            color: white;
            text-decoration: none;
            padding: 10px 18px;
            border-radius: 25px;
            transition: background 0.2s ease, transform 0.2s ease;
            cursor: pointer;
            font-weight: 500;
        }

        .desktop-menu a:hover {
            background: rgba(255, 255, 255, 0.35);
            transform: translateY(-1px);
        }
        
        /* Search and Sort */
        .search-container {
            max-width: 850px;
            margin: 2.5rem auto 0;
            padding: 0 1.5rem;
            position: sticky;
            top: 75px; /* Adjusted to be below header */
            z-index: 90;
            background-color: transparent; /* Overlay effect */
            transition: background-color 0.3s, color 0.3s;
        }
        
        .search-bar {
            display: flex;
            background: white;
            border-radius: 30px;
            overflow: hidden;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }

        .search-bar input {
            flex: 1;
            padding: 1.1rem 1.8rem;
            border: none;
            outline: none;
            font-size: 1.05rem;
            color: #34495e;
            transition: background-color 0.3s, color 0.3s;
        }
        
        .search-bar button {
            background: #27ae60; /* A fresh green */
            color: white;
            border: none;
            padding: 0 1.8rem;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.1s ease;
            font-size: 1.1rem;
        }
        
        .search-bar button:hover {
            background: #229a55; /* Darker green */
            transform: scale(1.02);
        }

        .sort-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 1.5rem;
            justify-content: flex-end; /* Align to the right */
        }

        .sort-container label {
            font-size: 0.95rem;
            color: #555;
            font-weight: 600;
        }
        body.dark-mode .sort-container label {
            color: #b0b9c5;
        }

        .sort-dropdown {
            padding: 0.7rem 1rem;
            border: 1px solid #dce2e8;
            border-radius: 8px;
            background-color: white;
            font-size: 0.95rem;
            color: #34495e;
            cursor: pointer;
            outline: none;
            transition: border-color 0.2s ease, box-shadow 0.2s ease, background-color 0.3s;
        }
        body.dark-mode .sort-dropdown {
            background-color: #2d3748;
            color: #e2e8f0;
            border-color: #4a5568;
        }

        .sort-dropdown:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .hero-tagline {
            text-align: center;
            font-size: 1.6rem;
            color: #555;
            margin: 1.5rem auto 3rem auto;
            padding: 0 1.5rem;
            max-width: 900px;
            font-weight: 500;
            line-height: 1.4;
            letter-spacing: -0.2px;
        }

        body.dark-mode .hero-tagline {
            color: #b0b9c5;
        }
        
        /* Assets Grid */
        .assets-container {
            width: 100%;
            padding: 2.5rem 1.5rem;
            flex-grow: 1; /* Allow container to take available space */
        }
        
        .assets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 2rem;
            width: 100%;
            max-width: 1200px; /* Constrain grid width */
            margin: 0 auto; /* Center the grid */
            justify-content: center;
        }
        
        .asset-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
            display: flex;
            flex-direction: column;
            cursor: pointer;
        }
        
        .asset-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
        }
        
        .asset-image {
            height: 200px;
            background-color: #ecf0f1; /* Light gray placeholder */
            display: flex;
            align-items: center;
            justify-content: center;
            color: #bdc3c7; /* Muted icon color */
            overflow: hidden;
        }

        .asset-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        .asset-card:hover .asset-image img {
            transform: scale(1.05);
        }
        
        .asset-image i {
            font-size: 3.5rem;
        }
        
        .asset-details {
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }
        
        .asset-title {
            font-size: 1.35rem;
            margin-bottom: 0.75rem;
            font-weight: 700;
            color: #2c3e50; /* Darker blue */
            transition: color 0.3s;
        }
        
        .asset-description {
            color: #61778d; /* Muted gray for description */
            font-size: 0.95rem;
            margin-bottom: 1.2rem;
            flex-grow: 1;
            transition: color 0.3s;
        }
        
        .asset-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            color: #7f8c8d; /* Even more muted */
            border-top: 1px solid #f2f2f2;
            padding-top: 1rem;
            margin-top: 0.5rem;
            transition: color 0.3s;
        }
        
        .download-btn {
            background: #3498db; /* Primary blue button */
            color: white;
            border: none;
            padding: 0.6rem 1.2rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: background 0.3s ease, transform 0.1s ease;
        }
        
        .download-btn:hover {
            background: #2980b9; /* Darker blue */
            transform: translateY(-1px);
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            margin: 3.5rem 0 2.5rem;
            flex-wrap: wrap;
            gap: 0.75rem;
        }
        
        .page-btn {
            background: white;
            border: 1px solid #dce2e8;
            color: #3498db;
            padding: 0.6rem 1.1rem;
            cursor: pointer;
            border-radius: 6px;
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.3s ease;
            min-width: 40px;
            text-align: center;
        }
        
        .page-btn:hover {
            background: #eaf3fa;
            color: #2980b9;
            border-color: #aed6f1;
        }
        
        .page-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
        }
        
        /* Footer */
        footer {
            background: #2c3e50; /* Dark blue from palette */
            color: #e2e8f0;
            padding: 2.5rem 0;
            text-align: center;
            margin-top: auto;
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.08);
        }
        
        .footer-content {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }

        .footer-content p {
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
            line-height: 1.6;
            color: #a0aec0;
        }

        .social-icons {
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .social-icons a {
            color: #e2e8f0;
            font-size: 2rem;
            transition: color 0.3s ease, transform 0.2s ease;
        }

        .social-icons a:hover {
            color: #3498db; /* Primary blue hover */
            transform: translateY(-3px);
        }
        
        .copyright {
            margin-top: 1.5rem;
            font-size: 0.85rem;
            color: #7f8c8d;
        }
        
        /* Page Content (Contact, FAQ, Blog, How to Download, About Us) */
        .page-content-container {
            max-width: 900px;
            margin: 3rem auto;
            padding: 0 1.5rem;
            flex: 1; /* Allows content to push footer down */
        }
        
        .page-title {
            font-size: 2.5rem;
            margin-bottom: 2rem;
            color: #2980b9; /* Professional blue */
            text-align: center;
            font-weight: 800;
            letter-spacing: -0.8px;
            transition: color 0.3s;
        }
        
        .page-content {
            background: white;
            padding: 2.5rem;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            transition: background-color 0.3s;
        }

        .page-content h3 {
            font-size: 1.6rem;
            color: #34495e;
            margin-top: 2rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 0.5rem;
            font-weight: 700;
        }
        .page-content p, .page-content ul li {
            font-size: 1rem;
            color: #5d6d7e;
            margin-bottom: 1.2rem;
            line-height: 1.7;
        }
        .page-content ul {
            list-style-type: disc;
            padding-left: 25px;
            margin-bottom: 1.5rem;
        }
        .page-content ul li {
            margin-bottom: 0.5rem;
        }
        .page-content a {
            color: #3498db;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.2s ease;
        }
        .page-content a:hover {
            color: #2980b9;
            text-decoration: underline;
        }
        
        /* Contact Form */
        .contact-form {
            display: grid;
            gap: 1.8rem;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            margin-bottom: 0.7rem;
            font-weight: 600;
            color: #34495e;
            font-size: 0.95rem;
        }
        
        .form-group input,
        .form-group textarea {
            padding: 1rem;
            border: 1px solid #dce2e8;
            border-radius: 8px;
            font-size: 1rem;
            color: #34495e;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        
        .form-group input:focus,
        .form-group textarea:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            outline: none;
        }
        
        .form-group textarea {
            min-height: 180px;
            resize: vertical;
        }
        
        .submit-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.1s ease;
            margin-top: 1rem;
        }
        
        .submit-btn:hover {
            background: #229a55;
            transform: translateY(-2px);
        }
        
        /* FAQ */
        .faq-item {
            margin-bottom: 2rem;
            border-bottom: 1px solid #edf2f7;
            padding-bottom: 1.5rem;
        }
        .faq-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
            margin-bottom: 0;
        }
        
        .faq-question {
            font-weight: 700;
            font-size: 1.25rem;
            margin-bottom: 0.8rem;
            color: #2c3e50;
            transition: color 0.3s;
        }
        
        .faq-answer {
            color: #5d6d7e;
            line-height: 1.7;
            font-size: 0.98rem;
            transition: color 0.3s;
        }
        
        /* Blog */
        .blog-post {
            margin-bottom: 2.5rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid #edf2f7;
        }
        .blog-post:last-child {
            border-bottom: none;
            padding-bottom: 0;
            margin-bottom: 0;
        }
        
        .blog-title {
            font-size: 1.8rem;
            margin-bottom: 0.7rem;
            color: #2c3e50;
            transition: color 0.3s;
            text-align: left;
            font-weight: 700;
            cursor: pointer;
        }
        .blog-title:hover {
            color: #3498db;
        }
        
        .blog-meta {
            color: #8da1b9;
            font-size: 0.9rem;
            margin-bottom: 1.2rem;
            font-style: italic;
        }
        
        .blog-excerpt {
            margin-bottom: 1.2rem;
            color: #5d6d7e;
            line-height: 1.7;
            font-size: 0.98rem;
            transition: color 0.3s;
        }
        
        .read-more {
            color: #3498db;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.2s ease;
        }
        .read-more:hover {
            color: #2980b9;
            text-decoration: underline;
        }

        /* Digital Watch Styles */
        #digital-watch {
            position: fixed;
            bottom: 25px;
            left: 25px;
            background: rgba(44, 62, 80, 0.8); /* Dark blue with transparency */
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            color: white;
            padding: 12px 18px;
            border-radius: 12px;
            font-size: 1.6rem;
            font-weight: bold;
            text-align: center;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
            z-index: 1000;
            letter-spacing: 0.5px;
        }

        /* Scroll to Top Button Styles */
        #scroll-to-top-btn {
            position: fixed;
            bottom: 25px;
            right: 25px;
            background: #3498db; /* Primary blue */
            color: white;
            border: none;
            border-radius: 50%;
            width: 55px;
            height: 55px;
            font-size: 1.6rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.25);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out, background 0.3s ease, transform 0.2s ease;
            z-index: 999;
        }

        #scroll-to-top-btn.show {
            opacity: 1;
            visibility: visible;
        }

        #scroll-to-top-btn:hover {
            background: #2980b9;
            transform: translateY(-3px);
        }

        /* WhatsApp Sticky Icon */
        #whatsapp-sticky-btn {
            position: fixed;
            bottom: 90px; /* Adjust to be above scroll-to-top-btn */
            right: 25px;
            background-color: #25D366; /* WhatsApp green */
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 2.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 999;
            transition: background-color 0.3s ease, transform 0.2s ease;
            text-decoration: none; /* Removed the small dash/underline */
        }

        #whatsapp-sticky-btn:hover {
            background-color: #1DA851; /* Darker green on hover */
            transform: scale(1.05);
        }
        
        /* Responsive Adjustments */
        @media (max-width: 900px) {
            .assets-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                gap: 1.5rem;
            }
            .hero-tagline {
                font-size: 1.4rem;
            }
            .page-title {
                font-size: 2.2rem;
            }
        }

        @media (max-width: 768px) {
            header {
                padding: 0.8rem 1.5rem;
            }
            .logo { font-size: 1.6rem; }
            .header-right {
                gap: 15px;
            }
            .mobile-menu-items {
                right: 15px;
            }
            .search-container {
                margin-top: 2rem;
                padding: 0 1rem;
                top: 70px;
            }
            .search-bar input {
                padding: 0.9rem 1.2rem;
                font-size: 0.95rem;
            }
            .search-bar button {
                padding: 0 1.2rem;
            }
            .hero-tagline {
                font-size: 1.3rem;
                margin: 1.2rem auto 2.5rem auto;
                padding: 0 1rem;
            }
            .assets-container {
                padding: 2rem 1rem;
            }
            .assets-grid {
                grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            }
            .asset-image {
                height: 180px;
            }
            .page-content-container {
                margin: 2.5rem auto;
                padding: 0 1rem;
            }
            .page-title {
                font-size: 2rem;
                margin-bottom: 1.8rem;
            }
            .page-content {
                padding: 2rem;
            }
            .modal-content {
                max-width: 95%;
            }
            #digital-watch {
                font-size: 1.4rem;
                padding: 10px 15px;
                bottom: 15px;
                left: 15px;
            }
            #scroll-to-top-btn {
                width: 50px;
                height: 50px;
                font-size: 1.4rem;
                bottom: 18px;
                right: 18px;
            }
            #whatsapp-sticky-btn {
                width: 48px;
                height: 48px;
                font-size: 1.8rem;
                bottom: 65px;
                right: 12px;
            }
        }
        
        @media (max-width: 480px) {
            .search-bar { flex-direction: column; border-radius: 10px; }
            .search-bar input { border-radius: 10px 10px 0 0; padding: 1rem; }
            .search-bar button { padding: 0.8rem; border-radius: 0 0 10px 10px; font-size: 1rem;}
            .assets-grid { grid-template-columns: 1fr; }
            .pagination { flex-wrap: wrap; justify-content: center; gap: 0.5rem;}
            .page-btn { margin: 0.2rem; padding: 0.5rem 0.9rem;}
            .page-title { font-size: 1.8rem; }
            .logo { font-size: 1.4rem; }
            .hero-tagline { font-size: 1.1rem; margin-bottom: 2rem;}
            .asset-details { padding: 1.2rem; }
            .asset-title { font-size: 1.2rem; }
            .asset-description { font-size: 0.9rem; }
            .download-btn { padding: 0.5rem 1rem; font-size: 0.85rem;}
            .page-content { padding: 1.5rem; }
            .modal-header { padding: 1rem 1.2rem; }
            .modal-title { font-size: 1.4rem; }
            .modal-close { font-size: 1.6rem; }
            .modal-body { padding: 1.2rem; }
            .modal-image { height: 160px; margin-bottom: 1rem;}
            .modal-footer { padding: 1rem 1.2rem; }
            #digital-watch {
                font-size: 1.1rem;
                padding: 8px 10px;
                bottom: 10px;
                left: 10px;
            }
            #scroll-to-top-btn {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
                bottom: 12px;
                right: 12px;
            }
            #whatsapp-sticky-btn {
                width: 48px;
                height: 48px;
                font-size: 1.8rem;
                bottom: 65px;
                right: 12px;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <div class="modal-overlay" id="assetModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalAssetTitle">Asset Title</h3>
                <button class="modal-close" id="modalClose">&times;</button>
            </div>
            <div class="modal-body">
                <img src="" alt="Asset Image" class="modal-image" id="modalAssetImage">
                <div class="modal-description" id="modalAssetDescription">Asset description will appear here.</div>
            </div>
            <div class="modal-footer">
                <button class="download-btn" id="modalDownloadBtn">Download</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="blogPostModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalBlogPostTitle">Blog Post Title</h3>
                <button class="modal-close" id="modalBlogPostClose">&times;</button>
            </div>
            <div class="modal-body">
                <div id="modalBlogPostContent"></div>
            </div>
            <div class="modal-footer">
                </div>
        </div>
    </div>

    <header>
        <div class="header-left">
            <div class="logo">5K Digital Studio</div>
            </div>
        
        <div class="header-right">
            <button class="dark-mode-toggle" id="darkModeToggle">
                <i class="fas fa-moon"></i>
            </button>
            
            <div class="desktop-menu" id="desktop-menu">
                <a id="desktop-about-link"><i class="fas fa-info-circle"></i> About Us</a>
                <a id="desktop-contact-link"><i class="fas fa-envelope"></i> Contact</a>
                <a id="desktop-faq-link"><i class="fas fa-question-circle"></i> FAQ</a>
                <a id="desktop-blog-link"><i class="fas fa-blog"></i> Blog</a>
                <a id="desktop-download-guide-link"><i class="fas fa-download"></i> How to Download</a>
            </div>
            
            <button class="menu-btn" id="menu-btn"><i class="fas fa-bars"></i></button>
        </div>
        
        <div class="mobile-menu-items" id="mobile-menu-items">
            <div class="menu-items">
                <a id="mobile-about-link"><i class="fas fa-info-circle"></i> About Us</a>
                <a id="mobile-contact-link"><i class="fas fa-envelope"></i> Contact</a>
                <a id="mobile-faq-link"><i class="fas fa-question-circle"></i> FAQ</a>
                <a id="mobile-blog-link"><i class="fas fa-blog"></i> Blog</a>
                <a id="mobile-download-guide-link"><i class="fas fa-download"></i> How to Download</a>
            </div>
        </div>
    </header>
    
    <main id="content-area" style="flex: 1; display: flex; flex-direction: column;"></main>
    
    <footer>
        <div class="footer-content">
            <p>5K Digital Studio provides high-quality digital assets and courses for creators.</p>
            <div class="social-icons">
                <a href="https://www.instagram.com/5kdigitalstudio" target="_blank" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                <a href="https://www.tiktok.com/@5kdigitalstudio" target="_blank" aria-label="TikTok"><i class="fab fa-tiktok"></i></a>
                <a href="https://t.me/5kdigitalstudio" target="_blank" aria-label="Telegram"><i class="fab fa-telegram-plane"></i></a>
            </div>
            <p class="copyright">&copy; 2025 5K Digital Studio. All rights reserved.</p>
        </div>
    </footer>

    <div id="digital-watch"></div>
    <a href="https://wa.me/2348179977737" target="_blank" id="whatsapp-sticky-btn" title="Chat on WhatsApp">
        <i class="fab fa-whatsapp"></i>
    </a>
    <button id="scroll-to-top-btn" title="Go to top">
        <i class="fas fa-arrow-up"></i>
    </button>
    
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBJa8xvmu19M-tokkjT8Y4R9diGM4FG-Go",
            authDomain: "k-digital-studio-64d0f.firebaseapp.com",
            projectId: "k-digital-studio-64d0f",
            storageBucket: "k-digital-studio-64d0f.appId.com",
            messagingSenderId: "986818037155",
            appId: "1:986818037155:web:c41803fe1f9214477c0616",
            measurementId: "G-ZJ43QR9W71"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        
        // --- GLOBAL STATE ---
        let allAssets = [];
        let faqItems = [];
        let blogPosts = [];
        
        let filteredAssets = [];
        let currentPage = 1;
        const assetsPerPage = 20; // Changed from 8 to 20
        let currentModalAssetId = null;
        let userTimeZone = Intl.DateTimeFormat().resolvedOptions().timeZone; // Default to browser's timezone
        
        // --- DOM Elements ---
        const contentArea = document.getElementById('content-area');
        const menuBtn = document.getElementById('menu-btn');
        const mobileMenuItems = document.getElementById('mobile-menu-items');
        const darkModeToggle = document.getElementById('darkModeToggle');
        const assetModal = document.getElementById('assetModal');
        const modalClose = document.getElementById('modalClose');
        const modalAssetTitle = document.getElementById('modalAssetTitle');
        const modalAssetImage = document.getElementById('modalAssetImage');
        const modalAssetDescription = document.getElementById('modalAssetDescription');
        const modalDownloadBtn = document.getElementById('modalDownloadBtn');
        const digitalWatch = document.getElementById('digital-watch');
        // New DOM Elements for Blog Post Modal
        const blogPostModal = document.getElementById('blogPostModal');
        const modalBlogPostClose = document.getElementById('modalBlogPostClose');
        const modalBlogPostTitle = document.getElementById('modalBlogPostTitle');
        const modalBlogPostContent = document.getElementById('modalBlogPostContent');
        const scrollToTopBtn = document.getElementById('scroll-to-top-btn'); // Get the new button

        // --- INITIALIZATION ---
        async function init() {
            // Check for saved dark mode preference
            if (localStorage.getItem('darkMode') === 'enabled') {
                document.body.classList.add('dark-mode');
                darkModeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            }

            // Fetch all data from Firebase and user timezone concurrently
            await Promise.all([
                fetchAssets(),
                fetchFaqs(),
                fetchBlogPosts(),
                fetchUserTimeZone()
            ]);
            
            // Set up static event listeners
            setupStaticEventListeners();
            setupScrollToTop(); // Setup scroll-to-top functionality

            // Initial render based on URL hash or default to index
            const view = window.location.hash.substring(1) || 'index';
            renderView(view);

            // Start digital watch
            updateDigitalWatch();
            setInterval(updateDigitalWatch, 1000);
        }

        // Dark mode toggle functionality
        darkModeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            if (document.body.classList.contains('dark-mode')) {
                darkModeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                localStorage.setItem('darkMode', 'enabled');
            } else {
                darkModeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                localStorage.setItem('darkMode', 'disabled');
            }
        });

        // Asset Modal functionality
        modalClose.addEventListener('click', () => {
            assetModal.classList.remove('active');
        });

        modalDownloadBtn.addEventListener('click', () => {
            if (currentModalAssetId) {
                downloadAsset(currentModalAssetId);
                assetModal.classList.remove('active');
            }
        });

        assetModal.addEventListener('click', (e) => {
            if (e.target === assetModal) {
                assetModal.classList.remove('active');
            }
        });

        function showAssetModal(asset) {
            currentModalAssetId = asset.id;
            modalAssetTitle.textContent = asset.title;
            // Changed from textContent to innerHTML to render rich text
            modalAssetDescription.innerHTML = asset.description; 
            
            if (asset.image) {
                modalAssetImage.src = asset.image;
                modalAssetImage.style.display = 'block';
            } else {
                modalAssetImage.style.display = 'none';
            }
            
            assetModal.classList.add('active');
        }

        // Blog Post Modal functionality
        modalBlogPostClose.addEventListener('click', () => {
            blogPostModal.classList.remove('active');
        });

        blogPostModal.addEventListener('click', (e) => {
            if (e.target === blogPostModal) {
                blogPostModal.classList.remove('active');
            }
        });

        function showBlogPostModal(post) {
            modalBlogPostTitle.textContent = post.title;
            modalBlogPostContent.innerHTML = post.content || post.excerpt; // Fallback to excerpt if full content isn't there
            blogPostModal.classList.add('active');
        }


        async function fetchAssets() {
            try {
                const snapshot = await db.collection('products').get();
                allAssets = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                // Initial sort: alphabetical by title
                allAssets.sort((a, b) => a.title.localeCompare(b.title));
                filteredAssets = [...allAssets];
            } catch (error) {
                console.error("Error fetching assets:", error);
                console.log("Error loading products. Please try again later.");
            }
        }

        async function fetchFaqs() {
            try {
                const snapshot = await db.collection('faqs').get();
                faqItems = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            } catch (error) {
                console.error("Error fetching FAQs:", error);
                console.log("Error loading FAQs. Please try again later.");
            }
        }

        async function fetchBlogPosts() {
            try {
                const snapshot = await db.collection('blogs').orderBy('date', 'desc').get();
                blogPosts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            } catch (error) {
                console.error("Error fetching blog posts:", error);
                console.log("Error loading blog posts. Please try again later.");
            }
        }

        // Function to fetch user's timezone based on IP
        async function fetchUserTimeZone() {
            try {
                const response = await fetch('http://ip-api.com/json');
                const data = await response.json();
                if (data.status === 'success' && data.timezone) {
                    userTimeZone = data.timezone;
                    console.log("User timezone detected:", userTimeZone);
                } else {
                    console.error("Failed to detect timezone via IP API:", data.message || "Unknown error");
                }
            } catch (error) {
                console.error("Error fetching IP-based timezone:", error);
            }
        }

        function setupStaticEventListeners() {
            menuBtn.addEventListener('click', () => mobileMenuItems.classList.toggle('active'));

            // Ensure the logo always redirects to the index page
            document.querySelector('.logo').addEventListener('click', () => {
                currentPage = 1; // Reset current page to 1
                renderView('index');
            });
            
            // Setup navigation links
            ['desktop-about-link', 'mobile-about-link'].forEach(id => document.getElementById(id).addEventListener('click', () => renderView('about')));
            ['desktop-contact-link', 'mobile-contact-link'].forEach(id => document.getElementById(id).addEventListener('click', () => renderView('contact')));
            ['desktop-faq-link', 'mobile-faq-link'].forEach(id => document.getElementById(id).addEventListener('click', () => renderView('faq')));
            ['desktop-blog-link', 'mobile-blog-link'].forEach(id => document.getElementById(id).addEventListener('click', () => renderView('blog')));
            ['desktop-download-guide-link', 'mobile-download-guide-link'].forEach(id => document.getElementById(id).addEventListener('click', () => renderView('how-to-download')));


            // Handle browser back/forward buttons
            window.addEventListener('popstate', () => {
                const view = window.location.hash.substring(1) || 'index';
                renderView(view, false); // Don't push history state again
            });
        }
        
        function setupScrollToTop() {
            window.addEventListener('scroll', () => {
                if (window.scrollY > 200) { // Show button after scrolling down 200px
                    scrollToTopBtn.classList.add('show');
                } else {
                    scrollToTopBtn.classList.remove('show');
                }
            });

            scrollToTopBtn.addEventListener('click', () => {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth' // Smooth scroll animation
                });
            });
        }

        function renderView(view, pushState = true) {
            if (mobileMenuItems.classList.contains('active')) {
                mobileMenuItems.classList.remove('active');
            }
            
            if (pushState) {
                const path = view === 'index' ? window.location.pathname : `#${view}`;
                window.history.pushState({view}, '', path);
            }

            switch(view) {
                case 'about':
                    renderAboutPage();
                    break;
                case 'contact':
                    renderContactPage();
                    break;
                case 'faq':
                    renderFAQPage();
                    break;
                case 'blog':
                    renderBlogPage();
                    break;
                case 'how-to-download':
                    renderHowToDownloadPage();
                    break;
                default:
                    renderIndexPage();
                    break;
            }
        }

        // Function to truncate HTML text
        function truncateHtml(htmlString, maxLength) {
            // Create a temporary div to parse the HTML string
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = htmlString;

            let textContent = tempDiv.textContent || tempDiv.innerText || '';
            
            // Remove extra whitespace and newlines for more accurate character count
            textContent = textContent.replace(/\s+/g, ' ').trim();

            if (textContent.length <= maxLength) {
                return htmlString; // Return original HTML if it's already short enough
            }

            // Find the last complete word before or at maxLength
            let truncatedText = textContent.substring(0, maxLength);
            let lastSpaceIndex = truncatedText.lastIndexOf(' ');

            if (lastSpaceIndex > (maxLength - 20)) { // Ensure we don't cut too short if last word is long
                truncatedText = truncatedText.substring(0, lastSpaceIndex);
            }

            // Append ellipsis
            return truncatedText + '...';
        }

        // --- PAGE RENDERERS ---
        
        function renderIndexPage() {
            contentArea.innerHTML = `
                <div class="search-container">
                    <div class="search-bar">
                        <input type="text" id="search-input" placeholder="Search for assets, courses...">
                        <button id="search-btn"><i class="fas fa-search"></i></button>
                    </div>
                    <div class="sort-container">
                        <label for="sort-dropdown">Sort by:</label>
                        <select id="sort-dropdown" class="sort-dropdown">
                            <option value="alphabetical-asc">Alphabetical (A-Z)</option>
                            <option value="alphabetical-desc">Alphabetical (Z-A)</option>
                            <option value="downloads-desc">Downloads (High to Low)</option>
                            <option value="downloads-asc">Downloads (Low to High)</option>
                        </select>
                    </div>
                </div>
                <div class="hero-tagline">Premium Digital Assets & Courses</div>
                <div class="assets-container">
                    <div class="assets-grid" id="assets-grid"></div>
                    <div class="pagination" id="pagination"></div>
                </div>
            `;
            
            document.getElementById('search-btn').addEventListener('click', handleSearch);
            document.getElementById('search-input').addEventListener('keyup', (e) => {
                if (e.key === 'Enter') handleSearch();
            });
            document.getElementById('sort-dropdown').addEventListener('change', handleSort);

            // Ensure the dropdown reflects the current sorting if it was set programmatically
            // (e.g., if a default sort order is applied on initial load)
            // For now, it defaults to A-Z as per fetchAssets.
            
            renderAssets();
            renderPagination();
        }

        function renderAboutPage() {
            contentArea.innerHTML = `
                <div class="page-content-container">
                    <h1 class="page-title">About 5K Digital Studio</h1>
                    <div class="page-content">
                        <p>Welcome to <strong>5K Digital Studio</strong>, your premier destination for high-quality digital assets and comprehensive creative courses. We are passionate about empowering creators, designers, and enthusiasts with the tools and knowledge they need to bring their visions to life.</p>
                        
                        <h3>Our Mission</h3>
                        <p>Our mission is to democratize creativity by providing accessible, top-tier digital resources. We believe that everyone, regardless of their skill level, should have access to the best assets and education to excel in their creative endeavors. We strive to be a catalyst for innovation and artistic expression.</p>
                        
                        <h3>What We Offer</h3>
                        <ul>
                            <li><strong>Premium Digital Assets:</strong> Explore our extensive library of meticulously crafted digital assets, including graphics, templates, sound effects, video elements, and more. Each asset is designed to save you time and elevate your projects.</li>
                            <li><strong>Comprehensive Courses:</strong> Dive deep into various creative disciplines with our expert-led courses. Whether you're a beginner looking to learn the basics or a seasoned professional aiming to refine your skills, our courses cover everything from graphic design and video editing to 3D modeling and digital art.</li>
                            <li><strong>Community and Support:</strong> Join a thriving community of fellow creators. We offer dedicated support to ensure you get the most out of our resources and overcome any creative challenges you face.</li>
                        </ul>
                        
                        <h3>Our Vision</h3>
                        <p>We envision a world where creativity knows no bounds, and every idea can be transformed into a masterpiece. 5K Digital Studio is committed to continuously expanding our offerings, embracing new technologies, and fostering a supportive environment for global creative talent.</p>

                        <p>Thank you for choosing 5K Digital Studio. We're excited to be part of your creative journey!</p>
                    </div>
                </div>
            `;
        }
        
        function renderContactPage() {
            contentArea.innerHTML = `
                <div class="page-content-container">
                    <h1 class="page-title">Contact Us</h1>
                    <div class="page-content">
                        <p>Have questions or need support? Reach out to our team using the form below.</p>
                        <form class="contact-form" id="contact-form">
                            <div class="form-group"><label for="name">Your Name</label><input type="text" id="name" required></div>
                            <div class="form-group"><label for="email">Email Address</label><input type="email" id="email" required></div>
                            <div class="form-group"><label for="subject">Subject</label><input type="text" id="subject" required></div>
                            <div class="form-group"><label for="message">Message</label><textarea id="message" required></textarea></div>
                            <button type="submit" class="submit-btn">Send Message</button>
                        </form>
                    </div>
                </div>
            `;
            
            document.getElementById('contact-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const name = document.getElementById('name').value;
                const email = document.getElementById('email').value;
                const subject = document.getElementById('subject').value;
                const message = document.getElementById('message').value;

                try {
                    await db.collection('contactMessages').add({
                        name,
                        email,
                        subject,
                        message,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    console.log('Message sent successfully!');
                    // Replaced alert with a simple console log for Canvas environment
                    console.log('Thank you for your message! We will get back to you soon.'); 
                    e.target.reset();
                } catch (error) {
                    console.error("Error sending message:", error);
                    // Replaced alert with a simple console log for Canvas environment
                    console.log("Error sending message. Please try again later."); 
                }
            });
        }
        
        function renderFAQPage() {
            let faqHTML = faqItems.length > 0 
                ? faqItems.map(item => `
                    <div class="faq-item">
                        <div class="faq-question">${item.question}</div>
                        <div class="faq-answer">${item.answer}</div>
                    </div>`).join('')
                : '<p>No FAQs have been added yet.</p>';
            
            contentArea.innerHTML = `
                <div class="page-content-container">
                    <h1 class="page-title">Frequently Asked Questions</h1>
                    <div class="page-content">${faqHTML}</div>
                </div>
            `;
        }
        
        function renderBlogPage() {
            let blogHTML = blogPosts.length > 0
                ? blogPosts.map(post => `
                    <div class="blog-post">
                        <h2 class="blog-title" data-id="${post.id}" style="cursor: pointer;">${post.title}</h2>
                        <div class="blog-meta">Posted on ${new Date(post.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</div>
                        <p class="blog-excerpt">${post.excerpt}</p>
                        <a href="#" class="read-more" data-id="${post.id}">Read more </a>
                    </div>`).join('')
                : '<p>No blog posts have been added yet.</p>';

            contentArea.innerHTML = `
                <div class="page-content-container">
                    <h1 class="page-title">Blog</h1>
                    <div class="page-content">${blogHTML}</div>
                </div>
            `;

            // Add event listeners to blog titles and "Read more" links
            document.querySelectorAll('.blog-title, .read-more').forEach(element => {
                element.addEventListener('click', function(e) {
                    e.preventDefault(); // Prevent default link behavior
                    const postId = this.getAttribute('data-id');
                    const post = blogPosts.find(p => p.id === postId);
                    if (post) {
                        showBlogPostModal(post);
                    }
                });
            });
        }

        function renderHowToDownloadPage() {
            contentArea.innerHTML = `
                <div class="page-content-container">
                    <h1 class="page-title">How to Download Assets</h1>
                    <div class="page-content">
                        <p>Downloading digital assets from 5K Digital Studio is a simple and straightforward process. Follow these steps to get your desired files:</p>
                        
                        <h3>Step 1: Browse or Search for Assets</h3>
                        <p>On the homepage, you can browse through various categories of digital assets or use the search bar to find a specific asset or course.</p>
                        
                        <h3>Step 2: Select Your Desired Asset</h3>
                        <p>Once you find an asset you're interested in, click on its card to view more details. A modal window will pop up showing the asset's title, a larger image (if available), and a detailed description.</p>
                        
                        <h3>Step 3: Click the Download Button</h3>
                        <p>Inside the asset's detail modal, you will see a "Download" button. Click this button to initiate the download. If a direct download link is available, your browser will typically start the download automatically.</p>
                        
                        <h3>Step 4: Complete a Quick Verification</h3>
                        <p>To ensure the security and integrity of our digital assets, and to prevent automated downloads, we require a quick verification. This helps us maintain a high-quality service for all users. Please complete the short verification step that appears.</p>

                        <h3>Step 5: Confirm and Save</h3>
                        <p>Depending on your browser settings, you might be prompted to choose a location to save the file. Select your preferred destination and confirm the download.</p>
                        
                        <h3>Troubleshooting Tips:</h3>
                        <ul>
                            <li><strong>Download Not Starting:</strong> Ensure your browser's pop-up blocker is not preventing the download.</li>
                            <li><strong>Slow Download:</strong> Your internet connection speed may affect download times.</li>
                            <li><strong>Corrupted File:</strong> If the downloaded file is corrupted, try downloading it again. If the problem persists, please contact our support team via the <a href="#contact">Contact Us</a> page.</li>
                        </ul>
                        <p>If you encounter any issues not covered here, feel free to visit our <a href="#faq">FAQ page</a> or <a href="#contact">contact us directly</a>.</p>
                    </div>
                </div>
            `;
        }
        
        // --- ASSET RENDERING & PAGINATION ---
        
        function renderAssets() {
            const assetsGrid = document.getElementById('assets-grid');
            assetsGrid.innerHTML = '';
            
            const assetsToShow = filteredAssets.slice((currentPage - 1) * assetsPerPage, currentPage * assetsPerPage);
            
            if (assetsToShow.length === 0) {
                assetsGrid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #7f8c8d; padding: 2rem 0;">No assets found.</p>';
                return;
            }
            
            assetsToShow.forEach(asset => {
                const assetCard = document.createElement('div');
                assetCard.className = 'asset-card';
                
                const imageContent = asset.image
                    ? `<img src="${asset.image}" alt="${asset.title}">`
                    : `<i class="${asset.icon || 'fas fa-file'}"></i>`;

                // Truncate the description for the card display
                const truncatedDescription = truncateHtml(asset.description, 100); // Set your desired character limit here (e.g., 100 characters)

                assetCard.innerHTML = `
                    <div class="asset-image">${imageContent}</div>
                    <div class="asset-details">
                        <h3 class="asset-title">${asset.title}</h3>
                        <p class="asset-description">${truncatedDescription}</p>
                        <div class="asset-meta">
                            <span>${(asset.downloads || 0).toLocaleString()} downloads</span>
                            <button class="download-btn" data-id="${asset.id}">Download</button>
                        </div>
                    </div>
                `;
                assetsGrid.appendChild(assetCard);

                // Add click event to show modal when clicking anywhere on the card
                assetCard.addEventListener('click', (e) => {
                    // Don't trigger if clicking on the download button
                    if (!e.target.classList.contains('download-btn')) {
                        showAssetModal(asset);
                    }
                });
            });
            
            document.querySelectorAll('.download-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation(); // Prevent the card click event from firing
                    downloadAsset(this.getAttribute('data-id'));
                });
            });
        }
        
        function renderPagination() {
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';
            const totalPages = Math.ceil(filteredAssets.length / assetsPerPage);
            
            if (totalPages <= 1) return;
            
            for (let i = 1; i <= totalPages; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
                pageBtn.textContent = i;
                pageBtn.addEventListener('click', () => {
                    currentPage = i;
                    renderAssets();
                    renderPagination();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
                pagination.appendChild(pageBtn);
            }
        }
        
        function handleSearch() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase().trim();
            
            filteredAssets = allAssets.filter(asset => 
                asset.title.toLowerCase().includes(searchTerm) || 
                asset.description.toLowerCase().includes(searchTerm) ||
                asset.type.toLowerCase().includes(searchTerm)
            );
            
            currentPage = 1;
            // Re-apply current sort order after filtering
            const currentSortValue = document.getElementById('sort-dropdown')?.value || 'alphabetical-asc';
            sortAssets(currentSortValue); // Sort after filtering
            renderAssets();
            renderPagination();
        }

        function handleSort() {
            const sortValue = document.getElementById('sort-dropdown').value;
            sortAssets(sortValue);
            currentPage = 1; // Reset to first page on sort
            renderAssets();
            renderPagination();
        }

        function sortAssets(sortValue) {
            switch (sortValue) {
                case 'alphabetical-asc':
                    filteredAssets.sort((a, b) => a.title.localeCompare(b.title));
                    break;
                case 'alphabetical-desc':
                    filteredAssets.sort((a, b) => b.title.localeCompare(a.title));
                    break;
                case 'downloads-desc':
                    filteredAssets.sort((a, b) => (b.downloads || 0) - (a.downloads || 0));
                    break;
                case 'downloads-asc':
                    filteredAssets.sort((a, b) => (a.downloads || 0) - (b.downloads || 0));
                    break;
                default:
                    // Default to alphabetical-asc if an unknown value is passed
                    filteredAssets.sort((a, b) => a.title.localeCompare(b.title));
                    break;
            }
        }
        
        function downloadAsset(assetId) {
            const asset = allAssets.find(a => a.id === assetId);
            if (asset) {
                if (asset.downloadLink) {
                    // Update download count in Firestore
                    db.collection('products').doc(assetId).update({
                        downloads: firebase.firestore.FieldValue.increment(1),
                        lastDownloaded: firebase.firestore.FieldValue.serverTimestamp()
                    }).then(() => {
                        // Open download link after updating count
                        window.open(asset.downloadLink, '_blank');
                    }).catch(error => {
                        console.error("Error updating download count:", error);
                        window.open(asset.downloadLink, '_blank');
                    });
                } else {
                    console.log(`Downloading: ${asset.title}\n\n(This is a demo. No file will be downloaded as no download link was provided.)`);
                }
            }
        }

        function updateDigitalWatch() {
            const now = new Date();
            const options = {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false,
                timeZone: userTimeZone
            };
            digitalWatch.textContent = now.toLocaleTimeString('en-US', options);
        }
        
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
